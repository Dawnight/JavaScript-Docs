<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>self-promise</title>
  <style>
    #box {
      width: 300px;
      height: 300px;
      background: orange;
      text-align: center;
      line-height: 300px;
    }

    #btn {
      padding: 10px;
      background: #00f55f;
      border: 1px solid #b6ff00;
      border-radius: 50%;
    }
  </style>
</head>
<body>
<div id="box">
  <button id="btn">
    <span>hello</span>
  </button>
  <button id="btnJquery">
    <span>hello</span>
  </button>
</div>
<ul id="ul">
  <li>1</li>
  <li>2</li>
</ul>
<script>
  function Promise(fn) {
    var status = 'pending';
    var successArray = [];
    var failArray = [];

    function successNotify() {
      status = 'resolved';
      todoThen();
    }

    function failNotify() {
      status = 'rejected';
      todoThen();
    }

    function todoThen() {
      if (status === 'resolved') {
        for (let i = 0; i < successArray.length; i++) {
          successArray[i].call();
        }
      } else if (status === 'rejected') {
        for (let i = 0; i < failArray.length; i++) {
          failArray[i].call();
        }
      }
    }

    fn.call(undefined, successNotify, failNotify);

    return {
      then: function (successFn, failFn) {
        successArray.push(successFn);
        failArray.push(failFn);
        // 简化
        return undefined;
      }
    }
  }

  window.onload = function () {
    let btn = document.getElementById('btn');
    btn.addEventListener('click', e => {
      console.log(e);
      // this指的是window对象
      console.log(this);
    });

    btn.onclick = function (e) {
      // e指的是事件
      console.log(e);
      // this指的是触发事件的dom元素
      console.log(this);
    };

    // btn.onclick.call({name: 'mark'});

    $('#btnJquery').on('click', function (e) {
      // e指的是jQuery的事件对象
      console.log(e);
      // this 指的是触发事件的dom元素
      console.log(this);
    });

    $('#ul').on('click', 'li', function (e) {
      // e指的是jQuery的事件对象
      console.log(e);
      // this指的是li选择器对应的元素
      console.log(this);
    });

  }
</script>
<script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.js"></script>
</body>
</html>
