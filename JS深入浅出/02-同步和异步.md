# 1. 同步和异步
+ 同步：等待结果
+ 异步：不等待结果
+ 异步常常伴随回调一起出现，但是异步不是回调，回调也不一定是异步

+ 同步的sleep
```javascript
function sleep(time) {
  var start = new Date();
  while(new Date() - start < time * 1000) {}
  return true;
}

console.log(1);
sleep(3);
console.log('wake up');
console.log(2);
```
+ 异步的sleep

```javascript
function sleep(time, fn) {
  setTimeout(fn, time * 1000);
}

console.log(1);
sleep(3, ()=>{console.log('wake up')});
console.log(2);
```
+ 使用了异步之后，js就有了空闲时间，实际上是浏览器在做这个计时器的工作。

# 2. 异步的例子
+ AJAX一定要使用异步请求，不然js就会一直停下来，一直等到server返回响应，js接收到响应后，才可以继续执行js代码
+ 图片加载的异步，图片的加载是一个异步的过程
```javascript
var img = document.getElementsByTagName('img')[0];
  img.onload = function () {
    var w = img.width;
    console.log('wwww: ', w);							// 结果为 width的宽度
  };

  console.log('img.width: ', img.width);	// 结果为 0
```
+ 面试的异步题

使用`var`

```javascript
let liList = document.querySelectorAll('li');
var i;
for (i = 0; i < liList.length; i++) {
	liList[i].onclick = function () {
		console.log(i);
	}
}
console.log(i);
// 所以输出的结果肯定是最后一个i的值
// 实际上是click的值是最后一个i的值
```

使用`let`

```javascript
let liList = document.querySelectorAll('li');
for (let i = 0; i < liList.length; i++) {
	liList[i].onclick = function () {
		console.log(i);
	}
}
```

# 3. 异步的形式

### 3.1 轮询/回调

+ 轮询
	+ 比如说要让别人给自己买一瓶饮料，买完后就放在桌子上。轮询的意思就是，我不停的去看桌子上是不是有饮料，桌子上有饮料的话，就说明饮料买好了，事件结束。
+ 回调

```javascript
function buyFruit(fn) {
  setTimeout(() => {
    fn.call(undefined, '买到了');
  }, 5000);
}

buyFruit(function() {
  console.log(arguments[0]);
});
```
### 3.2 回调的形式
+ Node.js的回调是`error-first`
+ jQuery的success/error方式
```javascript
$.ajax({
	url: '/xxx',
	success: () => {},
	error: () => {},
})
```

+ jQuery的done/fail/always形式

```javascript
$.ajax({
	url: '/xxx'
}).done(() => {}).fail(() => {}).always(() => {});
```

+ Promise的`then`形式

[Promise深入阅读](http://www.cnblogs.com/hustskyking/p/promise.html)

[Promise A+ 规范](https://segmentfault.com/a/1190000002452115)

```javascript
$.ajax({
	url: '/xxx'
}).then(
  (success) => {}, 
  (fail) => {}).then(
    (success) => {}, 
    (fail) => {}
	);
```
